

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>C# Client &mdash; kRPC 0.4.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="kRPC 0.4.3 documentation" href="../index.html"/>
        <link rel="up" title="C#" href="../csharp.html"/>
        <link rel="next" title="KRPC API" href="api/krpc.html"/>
        <link rel="prev" title="C#" href="../csharp.html"/>
 
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61341323-1', 'auto');
  ga('send', 'pageview');
</script>


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> kRPC
          

          
          </a>

          
            
            
              <div class="version">
                0.4.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials and Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cnano.html">C-nano</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../csharp.html">C#</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">C# Client</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-the-library">Installing the Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connecting-to-the-server">Connecting to the Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calling-remote-procedures">Calling Remote Procedures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#streaming-data-from-the-server">Streaming Data from the Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#synchronizing-with-stream-updates">Synchronizing with Stream Updates</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#condition-variables">Condition Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#callbacks">Callbacks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#custom-events">Custom Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="#client-api-reference">Client API Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api/krpc.html">KRPC API</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/space-center.html">SpaceCenter API</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/drawing.html">Drawing API</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/infernal-robotics.html">InfernalRobotics API</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/kerbal-alarm-clock.html">Kerbal Alarm Clock API</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/remote-tech.html">RemoteTech API</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/ui.html">User Interface API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cpp.html">C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../java.html">Java</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lua.html">Lua</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../third-party.html">Other Clients, Services and Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compiling.html">Compiling kRPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending.html">Extending kRPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../communication-protocols.html">Communication Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internals.html">Internals of kRPC</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">kRPC</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../csharp.html">C#</a> &raquo;</li>
        
      <li>C# Client</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/csharp/client.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="c-client">
<h1>C# Client<a class="headerlink" href="#c-client" title="Permalink to this headline">¶</a></h1>
<p>This client provides a C# API for interacting with a kRPC server. It is distributed as an assembly
named <code class="docutils literal"><span class="pre">KRPC.Client.dll</span></code>.</p>
<div class="section" id="installing-the-library">
<h2>Installing the Library<a class="headerlink" href="#installing-the-library" title="Permalink to this headline">¶</a></h2>
<p>The C# client can be <a class="reference external" href="https://www.nuget.com/packages/KRPC.Client">installed using NuGet</a> or
<a class="reference external" href="https://github.com/krpc/krpc/releases/download/v0.4.3/krpc-csharp-0.4.3.zip">downloaded from GitHub</a>. Two versions of the client are
provided: one compatible with .NET 4.5 and one for .NET 3.5.</p>
<p>You also need to <a class="reference external" href="https://www.nuget.org/packages/Google.Protobuf">install Google.Protobuf using NuGet</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The copy of <code class="docutils literal"><span class="pre">Google.Protobuf.dll</span></code> in the GameData folder included with the kRPC server plugin
is <em>not</em> the official release of this assembly. It is a modified version built for .NET 3.5 so
that it works within KSP.</p>
</div>
</div>
<div class="section" id="connecting-to-the-server">
<h2>Connecting to the Server<a class="headerlink" href="#connecting-to-the-server" title="Permalink to this headline">¶</a></h2>
<p>To connect to a server, create a <a class="reference internal" href="#class-Connection" title="Connection class"><code class="xref csharp csharp-type docutils literal"><span class="pre">Connection</span></code></a> object. All interaction with the server is done
via this object. When constructed without any arguments, it will connect to the local machine on the
default port numbers. You can specify different connection settings, and also a descriptive name for
the connection, as follows:</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KRPC.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KRPC.Client.Services.KRPC</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Program</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">connection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Connection</span><span class="p">(</span>
                   <span class="n">name</span><span class="p">:</span> <span class="s">&quot;My Example Program&quot;</span><span class="p">,</span>
                   <span class="n">address</span><span class="p">:</span> <span class="n">IPAddress</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="s">&quot;192.168.0.10&quot;</span><span class="p">),</span>
                   <span class="n">rpcPort</span><span class="p">:</span> <span class="m">1000</span><span class="p">,</span>
                   <span class="n">streamPort</span><span class="p">:</span> <span class="m">1001</span><span class="p">))</span> <span class="p">{</span>
            <span class="kt">var</span> <span class="n">krpc</span> <span class="p">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">KRPC</span><span class="p">();</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">krpc</span><span class="p">.</span><span class="n">GetStatus</span><span class="p">().</span><span class="n">Version</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#class-Connection" title="Connection class"><code class="xref csharp csharp-type docutils literal"><span class="pre">Connection</span></code></a> object needs to be disposed of correctly when finished with, so that the
network connection it manages can be released. This can be done with a <code class="docutils literal"><span class="pre">using</span></code> block (as in the
example above) or by calling <a class="reference internal" href="#method-Connection.Dispose" title="Connection.Dispose method"><code class="xref csharp csharp-meth docutils literal"><span class="pre">Connection.Dispose</span></code></a> directly.</p>
</div>
<div class="section" id="calling-remote-procedures">
<h2>Calling Remote Procedures<a class="headerlink" href="#calling-remote-procedures" title="Permalink to this headline">¶</a></h2>
<p>The kRPC server provides <em>procedures</em> that a client can run. These procedures are arranged in groups
called <em>services</em> to keep things organized. The functionality for the services are defined in the
namespace <code class="docutils literal"><span class="pre">KRPC.Client.Services.*</span></code>. For example, all of the functionality provided by the
<code class="docutils literal"><span class="pre">SpaceCenter</span></code> service is contained in the namespace <code class="docutils literal"><span class="pre">KRPC.Client.Services.SpaceCenter</span></code>.</p>
<p>To interact with a service, you must first instantiate it. You can then call its methods and
properties to invoke remote procedures. The following example demonstrates how to do this. It
instantiates the <code class="docutils literal"><span class="pre">SpaceCenter</span></code> service and calls
<a class="reference internal" href="api/space-center/space-center.html#property-KRPC.Client.Services.SpaceCenter.SpaceCenter.ActiveVessel" title="KRPC.Client.Services.SpaceCenter.SpaceCenter.ActiveVessel property"><code class="xref csharp csharp-prop docutils literal"><span class="pre">KRPC.Client.Services.SpaceCenter.SpaceCenter.ActiveVessel</span></code></a> to get an object representing the
active vessel (of type <a class="reference internal" href="api/space-center/vessel.html#class-KRPC.Client.Services.SpaceCenter.Vessel" title="KRPC.Client.Services.SpaceCenter.Vessel class"><code class="xref csharp csharp-type docutils literal"><span class="pre">KRPC.Client.Services.SpaceCenter.Vessel</span></code></a>). It sets the name of the
vessel and then prints out its altitude:</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KRPC.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KRPC.Client.Services.SpaceCenter</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Program</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">connection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Connection</span><span class="p">())</span> <span class="p">{</span>
            <span class="kt">var</span> <span class="n">spaceCenter</span> <span class="p">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">SpaceCenter</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">vessel</span> <span class="p">=</span> <span class="n">spaceCenter</span><span class="p">.</span><span class="n">ActiveVessel</span><span class="p">;</span>
            <span class="n">vessel</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="s">&quot;My Vessel&quot;</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">flightInfo</span> <span class="p">=</span> <span class="n">vessel</span><span class="p">.</span><span class="n">Flight</span><span class="p">();</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">flightInfo</span><span class="p">.</span><span class="n">MeanAltitude</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="streaming-data-from-the-server">
<span id="csharp-client-streams"></span><h2>Streaming Data from the Server<a class="headerlink" href="#streaming-data-from-the-server" title="Permalink to this headline">¶</a></h2>
<p>A common use case for kRPC is to continuously extract data from the game. The naive approach to do
this would be to repeatedly call a remote procedure, such as in the following which repeatedly
prints the position of the active vessel:</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KRPC.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KRPC.Client.Services.SpaceCenter</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Program</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">var</span> <span class="n">connection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Connection</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">spaceCenter</span> <span class="p">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">SpaceCenter</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">vessel</span> <span class="p">=</span> <span class="n">spaceCenter</span><span class="p">.</span><span class="n">ActiveVessel</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">refFrame</span> <span class="p">=</span> <span class="n">vessel</span><span class="p">.</span><span class="n">Orbit</span><span class="p">.</span><span class="n">Body</span><span class="p">.</span><span class="n">ReferenceFrame</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">vessel</span><span class="p">.</span><span class="n">Position</span><span class="p">(</span><span class="n">refFrame</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This approach requires significant communication overhead as request/response messages are
repeatedly sent between the client and server. kRPC provides a more efficient mechanism to achieve
this, called <em>streams</em>.</p>
<p>A stream repeatedly executes a procedure on the server (with a fixed set of argument values) and
sends the result to the client. It only requires a single message to be sent to the server to
establish the stream, which will then continuously send data to the client until the stream is
closed.</p>
<p>The following example does the same thing as above using streams:</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KRPC.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KRPC.Client.Services.SpaceCenter</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Program</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">var</span> <span class="n">connection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Connection</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">spaceCenter</span> <span class="p">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">SpaceCenter</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">vessel</span> <span class="p">=</span> <span class="n">spaceCenter</span><span class="p">.</span><span class="n">ActiveVessel</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">refFrame</span> <span class="p">=</span> <span class="n">vessel</span><span class="p">.</span><span class="n">Orbit</span><span class="p">.</span><span class="n">Body</span><span class="p">.</span><span class="n">ReferenceFrame</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">posStream</span> <span class="p">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">AddStream</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">vessel</span><span class="p">.</span><span class="n">Position</span><span class="p">(</span><span class="n">refFrame</span><span class="p">));</span>
        <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">posStream</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It calls <a class="reference internal" href="#method-Connection.AddStream" title="Connection.AddStream method"><code class="xref csharp csharp-meth docutils literal"><span class="pre">Connection.AddStream</span></code></a> once at the start of the program to create the stream, and
then repeatedly prints the position returned by the stream. The stream is automatically closed when
the client disconnects.</p>
<p>A stream can be created for any method call by calling <a class="reference internal" href="#method-Connection.AddStream" title="Connection.AddStream method"><code class="xref csharp csharp-meth docutils literal"><span class="pre">Connection.AddStream</span></code></a> and passing it
a lambda expression that invokes the desired method. This lambda expression must take zero arguments
and be either a method call expression or a parameter call expression. It returns a stream object of
type <a class="reference internal" href="#class-Stream" title="Stream class"><code class="xref csharp csharp-type docutils literal"><span class="pre">Stream</span></code></a>. The most recent value of the stream can be obtained by calling
<a class="reference internal" href="#method-Stream.Get" title="Stream.Get method"><code class="xref csharp csharp-meth docutils literal"><span class="pre">Stream.Get</span></code></a>. A stream can be stopped and removed from the server by calling
<a class="reference internal" href="#method-Stream.Remove" title="Stream.Remove method"><code class="xref csharp csharp-meth docutils literal"><span class="pre">Stream.Remove</span></code></a> on the stream object. All of a clients streams are automatically stopped when
it disconnects.</p>
</div>
<div class="section" id="synchronizing-with-stream-updates">
<h2>Synchronizing with Stream Updates<a class="headerlink" href="#synchronizing-with-stream-updates" title="Permalink to this headline">¶</a></h2>
<p>A common use case for kRPC is to wait until the value returned by a method or attribute changes, and
then take some action. kRPC provides two mechanisms to do this efficiently: <em>condition variables</em>
and <em>callbacks</em>.</p>
<div class="section" id="condition-variables">
<h3>Condition Variables<a class="headerlink" href="#condition-variables" title="Permalink to this headline">¶</a></h3>
<p>Each stream has a condition variable associated with it, that is notified whenever the value of the
stream changes. These can be used to block the current thread of execution until the value of the
stream changes.</p>
<p>The following example waits until the abort button is pressed in game, by waiting for the value of
<a class="reference internal" href="api/space-center/control.html#property-KRPC.Client.Services.SpaceCenter.Control.Abort" title="KRPC.Client.Services.SpaceCenter.Control.Abort property"><code class="xref csharp csharp-prop docutils literal"><span class="pre">KRPC.Client.Services.SpaceCenter.Control.Abort</span></code></a> to change to true:</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KRPC.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KRPC.Client.Services.SpaceCenter</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Program</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">var</span> <span class="n">connection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Connection</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">spaceCenter</span> <span class="p">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">SpaceCenter</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">control</span> <span class="p">=</span> <span class="n">spaceCenter</span><span class="p">.</span><span class="n">ActiveVessel</span><span class="p">.</span><span class="n">Control</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">abort</span> <span class="p">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">AddStream</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">control</span><span class="p">.</span><span class="n">Abort</span><span class="p">);</span>
        <span class="k">lock</span> <span class="p">(</span><span class="n">abort</span><span class="p">.</span><span class="n">Condition</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">while</span> <span class="p">(!</span><span class="n">abort</span><span class="p">.</span><span class="n">Get</span><span class="p">())</span>
                <span class="n">abort</span><span class="p">.</span><span class="n">Wait</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This code creates a stream, acquires a lock on the streams condition variable (by using a <code class="docutils literal"><span class="pre">lock</span></code>
statement) and then repeatedly checks the value of <code class="docutils literal"><span class="pre">Abort</span></code>. It leaves the loop when it changes to
true.</p>
<p>The body of the loop calls <code class="docutils literal"><span class="pre">Wait</span></code> on the stream, which causes the program to block until the value
changes. This prevents the loop from ‘spinning’ and so it does not consume processing resources
whilst waiting.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The stream does not start receiving updates until the first call to <code class="docutils literal"><span class="pre">Wait</span></code>. This means that the
example code will not miss any updates to the streams value, as it will have already locked the
condition variable before the first stream update is received.</p>
</div>
</div>
<div class="section" id="callbacks">
<h3>Callbacks<a class="headerlink" href="#callbacks" title="Permalink to this headline">¶</a></h3>
<p>Streams allow you to register callback functions that are called whenever the value of the stream
changes. Callback functions should take a single argument, which is the new value of the stream, and
should return nothing.</p>
<p>For example the following program registers two callbacks that are invoked when the value of
<a class="reference internal" href="api/space-center/control.html#property-KRPC.Client.Services.SpaceCenter.Control.Abort" title="KRPC.Client.Services.SpaceCenter.Control.Abort property"><code class="xref csharp csharp-prop docutils literal"><span class="pre">KRPC.Client.Services.SpaceCenter.Control.Abort</span></code></a> changes:</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KRPC.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KRPC.Client.Services.SpaceCenter</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Program</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">var</span> <span class="n">connection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Connection</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">spaceCenter</span> <span class="p">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">SpaceCenter</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">control</span> <span class="p">=</span> <span class="n">spaceCenter</span><span class="p">.</span><span class="n">ActiveVessel</span><span class="p">.</span><span class="n">Control</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">abort</span> <span class="p">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">AddStream</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">control</span><span class="p">.</span><span class="n">Abort</span><span class="p">);</span>

        <span class="n">abort</span><span class="p">.</span><span class="n">AddCallback</span><span class="p">(</span>
            <span class="p">(</span><span class="kt">bool</span> <span class="n">x</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Abort 1 called with a value of &quot;</span> <span class="p">+</span> <span class="n">x</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="n">abort</span><span class="p">.</span><span class="n">AddCallback</span><span class="p">(</span>
            <span class="p">(</span><span class="kt">bool</span> <span class="n">x</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Abort 2 called with a value of &quot;</span> <span class="p">+</span> <span class="n">x</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="n">abort</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>

        <span class="c1">// Keep the program running...</span>
        <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When a stream is created it does not start receiving updates until <code class="docutils literal"><span class="pre">Start</span></code> is called. This is
implicitly called when accessing the value of a stream, but as this example does not do this an
explicit call to <code class="docutils literal"><span class="pre">Start</span></code> is required.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The callbacks are registered before the call to <code class="docutils literal"><span class="pre">Start</span></code> so that stream updates are not missed.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The callback function may be called from a different thread to that which created the stream. Any
changes to shared state must therefore be protected with appropriate synchronization.</p>
</div>
</div>
</div>
<div class="section" id="custom-events">
<span id="csharp-client-events"></span><h2>Custom Events<a class="headerlink" href="#custom-events" title="Permalink to this headline">¶</a></h2>
<p>Some procedures return event objects of type <a class="reference internal" href="#class-Event" title="Event class"><code class="xref csharp csharp-type docutils literal"><span class="pre">Event</span></code></a>. These allow you to wait until an event
occurs, by calling <a class="reference internal" href="#method-Event.Wait" title="Event.Wait method"><code class="xref csharp csharp-meth docutils literal"><span class="pre">Event.Wait</span></code></a>. Under the hood, these are implemented using streams and
condition variables.</p>
<p>Custom events can also be created. An expression API allows you to create code that runs on the
server and these can be used to build a custom event. For example, the following creates the
expression <code class="docutils literal"><span class="pre">MeanAltitude</span> <span class="pre">&gt;</span> <span class="pre">1000</span></code> and then creates an event that will be triggered when the
expression returns true:</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KRPC.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KRPC.Client.Services.KRPC</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KRPC.Client.Services.SpaceCenter</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Program</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">var</span> <span class="n">connection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Connection</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">krpc</span> <span class="p">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">KRPC</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">spaceCenter</span> <span class="p">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">SpaceCenter</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">flight</span> <span class="p">=</span> <span class="n">spaceCenter</span><span class="p">.</span><span class="n">ActiveVessel</span><span class="p">.</span><span class="n">Flight</span><span class="p">();</span>

        <span class="c1">// Get the remote procedure call as a message object,</span>
        <span class="c1">// so it can be passed to the server</span>
        <span class="kt">var</span> <span class="n">meanAltitude</span> <span class="p">=</span> <span class="n">Connection</span><span class="p">.</span><span class="n">GetCall</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">flight</span><span class="p">.</span><span class="n">MeanAltitude</span><span class="p">);</span>

        <span class="c1">// Create an expression on the server</span>
        <span class="kt">var</span> <span class="n">expr</span> <span class="p">=</span> <span class="n">Expression</span><span class="p">.</span><span class="n">GreaterThan</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span>
            <span class="n">Expression</span><span class="p">.</span><span class="n">Call</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">meanAltitude</span><span class="p">),</span>
            <span class="n">Expression</span><span class="p">.</span><span class="n">ConstantDouble</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="m">1000</span><span class="p">));</span>

        <span class="kt">var</span> <span class="n">evnt</span> <span class="p">=</span> <span class="n">krpc</span><span class="p">.</span><span class="n">AddEvent</span><span class="p">(</span><span class="n">expr</span><span class="p">);</span>
        <span class="k">lock</span> <span class="p">(</span><span class="n">evnt</span><span class="p">.</span><span class="n">Condition</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">evnt</span><span class="p">.</span><span class="n">Wait</span><span class="p">();</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Altitude reached 1000m&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="client-api-reference">
<h2>Client API Reference<a class="headerlink" href="#client-api-reference" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="class-IConnection">
<code class="descname">class IConnection</code><a class="headerlink" href="#class-IConnection" title="Permalink to this definition">¶</a></dt>
<dd><p>Interface implemented by the <a class="reference internal" href="#class-Connection" title="Connection class"><code class="xref csharp csharp-type docutils literal"><span class="pre">Connection</span></code></a> class.</p>
</dd></dl>

<dl class="class">
<dt id="class-Connection">
<code class="descname">class Connection</code><a class="headerlink" href="#class-Connection" title="Permalink to this definition">¶</a></dt>
<dd><p>A connection to the kRPC server. All interaction with kRPC is performed via an instance of this
class.</p>
<dl class="method">
<dt id="method-Connection.Connection">
<code class="descname">Connection</code> <span class="sig-paren">(</span><a class="reference external" href="https://msdn.microsoft.com/en-us/library/system.string.aspx" title="System.String">String</a> <em>name</em><em> = “”</em>, <a class="reference external" href="https://msdn.microsoft.com/en-us/library/system.net.ipaddress.aspx" title="System.Net.IPAddress">Net.IPAddress</a> <em>address</em><em> = null</em>, <a class="reference external" href="https://msdn.microsoft.com/en-us/library/system.int32.aspx" title="System.Int32">Int32</a> <em>rpcPort</em><em> = 50000</em>, <a class="reference external" href="https://msdn.microsoft.com/en-us/library/system.int32.aspx" title="System.Int32">Int32</a> <em>streamPort</em><em> = 50001</em><span class="sig-paren">)</span><a class="headerlink" href="#method-Connection.Connection" title="Permalink to this definition">¶</a></dt>
<dd><p>Connect to a kRPC server.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> – A descriptive name for the connection. This is passed to the server and appears
in the in-game server window.</li>
<li><strong>address</strong> – The address of the server to connect to. Defaults to 127.0.0.1.</li>
<li><strong>rpc_port</strong> – The port number of the RPC Server. Defaults to 50000. This should match the
RPC port number of the server you want to connect to.</li>
<li><strong>stream_port</strong> – The port number of the Stream Server. Defaults to 50001. This should
match the stream port number of the server you want to connect to.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="method-Connection.AddStream">
<a class="reference internal" href="#class-Stream" title="Stream class">Stream</a>&lt;ReturnType&gt; <code class="descname">AddStream</code>&lt;ReturnType&gt; <span class="sig-paren">(</span>LambdaExpression <em>expression</em><span class="sig-paren">)</span><a class="headerlink" href="#method-Connection.AddStream" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new stream from the given lambda expression.</p>
</dd></dl>

<dl class="method">
<dt id="method-Connection.GetCall">
KRPC.Schema.KRPC.ProcedureCall <code class="descname">GetCall</code> <span class="sig-paren">(</span>LambdaExpression <em>expression</em><span class="sig-paren">)</span><a class="headerlink" href="#method-Connection.GetCall" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a procedure call message for the given lambda expression. This allows descriptions of
procedure calls to be passed to the server, for example when constructing custom events. See
<a class="reference internal" href="#csharp-client-events"><span class="std std-ref">Custom Events</span></a>.</p>
</dd></dl>

<dl class="method">
<dt id="method-Connection.Dispose">
void <code class="descname">Dispose</code> <span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#method-Connection.Dispose" title="Permalink to this definition">¶</a></dt>
<dd><p>Closes the connection and frees the resources associated with it.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="class-Stream">
<code class="descname">class Stream&lt;ReturnType&gt;</code><a class="headerlink" href="#class-Stream" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents a stream. See <a class="reference internal" href="#csharp-client-streams"><span class="std std-ref">Streaming Data from the Server</span></a>.</p>
<p>Stream objects implement <code class="docutils literal"><span class="pre">GetHashCode</span></code>, <code class="docutils literal"><span class="pre">Equals</span></code>, <code class="docutils literal"><span class="pre">operator</span> <span class="pre">==</span></code> and <code class="docutils literal"><span class="pre">operator</span> <span class="pre">!=</span></code> such
that two stream objects are equal if they are bound to the same stream on the server.</p>
<dl class="method">
<dt id="method-Stream.Start">
void <code class="descname">Start</code> <span class="sig-paren">(</span><a class="reference external" href="https://msdn.microsoft.com/en-us/library/system.boolean.aspx" title="System.Boolean">Boolean</a> <em>wait</em><em> = true</em><span class="sig-paren">)</span><a class="headerlink" href="#method-Stream.Start" title="Permalink to this definition">¶</a></dt>
<dd><p>Starts the stream. When a stream is created by calling <a class="reference internal" href="#method-Connection.AddStream" title="Connection.AddStream method"><code class="xref csharp csharp-meth docutils literal"><span class="pre">Connection.AddStream</span></code></a> it does
not start sending updates to the client until this method is called.</p>
<p>If wait is true, this method will block until at least one update has been received from the
server.</p>
<p>If wait is false, the method starts the stream and returns immediately. Subsequent calls to
<a class="reference internal" href="#method-Stream.Get" title="Stream.Get method"><code class="xref csharp csharp-meth docutils literal"><span class="pre">Get</span></code></a> may raise an <code class="docutils literal"><span class="pre">InvalidOperationException</span></code> if the stream does not yet contain a
value.</p>
</dd></dl>

<dl class="property">
<dt id="property-Stream.Rate">
<a class="reference external" href="https://msdn.microsoft.com/en-us/library/system.single.aspx" title="System.Single">Single</a> <code class="descname">Rate</code> { <em class="property">get; set;</em> }<a class="headerlink" href="#property-Stream.Rate" title="Permalink to this definition">¶</a></dt>
<dd><p>The update rate of the stream in Hertz. When set to zero, the rate is unlimited.</p>
</dd></dl>

<dl class="method">
<dt id="method-Stream.Get">
ReturnType <code class="descname">Get</code> <span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#method-Stream.Get" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the most recent value for the stream. If executing the remote procedure for the stream
throws an exception, calling this method will rethrow the exception. Raises an
<code class="docutils literal"><span class="pre">InvalidOperationException</span></code> if no update has been received from the server.</p>
<p>If the stream has not been started this method calls <code class="docutils literal"><span class="pre">Start(true)</span></code> to start the stream and
wait until at least one update has been received.</p>
</dd></dl>

<dl class="property">
<dt id="property-Stream.Condition">
object <code class="descname">Condition</code> { <em class="property">get;</em> }<a class="headerlink" href="#property-Stream.Condition" title="Permalink to this definition">¶</a></dt>
<dd><p>A condition variable that is notified (using <code class="docutils literal"><span class="pre">Monitor.PulseAll</span></code>) whenever the value of the
stream changes.</p>
</dd></dl>

<dl class="method">
<dt id="method-Stream.Wait">
void <code class="descname">Wait</code> <span class="sig-paren">(</span><a class="reference external" href="https://msdn.microsoft.com/en-us/library/system.double.aspx" title="System.Double">Double</a> <em>timeout</em><em> = -1</em><span class="sig-paren">)</span><a class="headerlink" href="#method-Stream.Wait" title="Permalink to this definition">¶</a></dt>
<dd><p>This method blocks until the value of the stream changes or the operation times out.</p>
<p>The streams condition variable must be locked before calling this method.</p>
<p>If <em>timeout</em> is specified and is greater than or equal to 0, it is the timeout in seconds for
the operation.</p>
<p>If the stream has not been started this method calls <code class="docutils literal"><span class="pre">Start(false)</span></code> to start the stream
(without waiting for at least one update to be received).</p>
</dd></dl>

<dl class="method">
<dt id="method-Stream.AddCallback">
void <code class="descname">AddCallback</code> <span class="sig-paren">(</span>Action&lt;ReturnType&gt; <em>callback</em><span class="sig-paren">)</span><a class="headerlink" href="#method-Stream.AddCallback" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a callback function that is invoked whenever the value of the stream changes. The
callback function should take one argument, which is passed the new value of the stream.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The callback function may be called from a different thread to that which created the
stream. Any changes to shared state must therefore be protected with appropriate
synchronization.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="method-Stream.Remove">
void <code class="descname">Remove</code> <span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#method-Stream.Remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes the stream from the server.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="class-Event">
<code class="descname">class Event</code><a class="headerlink" href="#class-Event" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents an event. See <a class="reference internal" href="#csharp-client-events"><span class="std std-ref">Custom Events</span></a>. It is wrapper around a
<a class="reference external" href="https://msdn.microsoft.com/en-us/library/system.boolean.aspx" title="System.Boolean">Boolean</a> that indicates when the event occurs.</p>
<p>Event objects implement <code class="docutils literal"><span class="pre">GetHashCode</span></code>, <code class="docutils literal"><span class="pre">Equals</span></code>, <code class="docutils literal"><span class="pre">operator</span> <span class="pre">==</span></code> and <code class="docutils literal"><span class="pre">operator</span> <span class="pre">!=</span></code> such
that two event objects are equal if they are bound to the same underlying stream on the server.</p>
<dl class="method">
<dt id="method-Event.Start">
void <code class="descname">Start</code> <span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#method-Event.Start" title="Permalink to this definition">¶</a></dt>
<dd><p>Starts the event. When an event is created, it will not receive updates from the server until
this method is called.</p>
</dd></dl>

<dl class="property">
<dt id="property-Event.Condition">
object <code class="descname">Condition</code> { <em class="property">get;</em> }<a class="headerlink" href="#property-Event.Condition" title="Permalink to this definition">¶</a></dt>
<dd><p>The condition variable that is notified (using <code class="docutils literal"><span class="pre">Monitor.PulseAll</span></code>) whenever the event
occurs.</p>
</dd></dl>

<dl class="method">
<dt id="method-Event.Wait">
void <code class="descname">Wait</code> <span class="sig-paren">(</span><a class="reference external" href="https://msdn.microsoft.com/en-us/library/system.double.aspx" title="System.Double">Double</a> <em>timeout</em><em> = -1</em><span class="sig-paren">)</span><a class="headerlink" href="#method-Event.Wait" title="Permalink to this definition">¶</a></dt>
<dd><p>This method blocks until the event occurs or the operation times out.</p>
<p>The events condition variable must be locked before calling this method.</p>
<p>If <em>timeout</em> is specified and is greater than or equal to 0, it is the timeout in seconds for
the operation.</p>
<p>If the event has not been started this method calls <code class="docutils literal"><span class="pre">Start()</span></code> to start the underlying
stream.</p>
</dd></dl>

<dl class="method">
<dt id="method-Event.AddCallback">
void <code class="descname">AddCallback</code> <span class="sig-paren">(</span>Action <em>callback</em><span class="sig-paren">)</span><a class="headerlink" href="#method-Event.AddCallback" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a callback function that is invoked whenever the event occurs. The callback function
should be a function that takes zero arguments.</p>
</dd></dl>

<dl class="method">
<dt id="method-Event.Remove">
void <code class="descname">Remove</code> <span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#method-Event.Remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes the event from the server.</p>
</dd></dl>

<dl class="property">
<dt id="property-Event.Stream">
<a class="reference internal" href="#class-Stream" title="Stream class">Stream</a>&lt;<a class="reference external" href="https://msdn.microsoft.com/en-us/library/system.boolean.aspx" title="System.Boolean">Boolean</a>&gt; <code class="descname">Stream</code> { <em class="property">get;</em> }<a class="headerlink" href="#property-Event.Stream" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the underlying stream for the event.</p>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api/krpc.html" class="btn btn-neutral float-right" title="KRPC API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../csharp.html" class="btn btn-neutral" title="C#" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2017, djungelorm.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.4.3',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script>
  // Open external links in a new window
  jQuery(document).ready(function($) {
    $('a').not('[href*="mailto:"]').each(function () {
      var isInternalLink = new RegExp('/' + window.location.host + '/');
      if (!isInternalLink.test(this.href)) {
        $(this).attr('target', '_blank');
      }
    });
  });
</script>


</body>
</html>